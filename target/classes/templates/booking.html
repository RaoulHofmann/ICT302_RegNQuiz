<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title> QuizNGo</title>
    <link rel = "stylesheet" type="text/css"
          href="/resources/css/regNGo.css">
<<<<<<< HEAD
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
=======
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css"/>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
>>>>>>> parent of 545255a... add colour to table in css file
    <script type="text/javascript" src="/resources/javascript/login.js"></script>
    <script type="text/javascript" src="/resources/javascript/booking.js"></script>
</head>
<body onload="booking_info();">
    <th:block th:if= "${booking != null}">
<<<<<<< HEAD
        <h1 th:text="'Attendance Code: '+${booking.attendanceCode}"></h1>
=======
        <h1>Attendance Code:</h1>
        <h3 th:text="${booking.attendanceCode}"></h3>
>>>>>>> parent of 545255a... add colour to table in css file
        <th:block th:if="${finished == null}">
            <th:block th:if= "${questions == null}">
                <a href="javascript: document.startQuestions.submit()" role="button" id="startQuestions">Display Question</a>
                <form name="startQuestions" th:action="@{/booking/{id}/question(id=${booking.bookingID})}" method="post" th:hidden="true">
                    <input hidden type="submit" value="Display Question"/>
                </form>
            </th:block>
            <th:block th:if= "${questions != null}">
                <a href="javascript: document.nextQuestions.submit()" role="button" id="nextQuestions">Next Question</a>
                <form name="nextQuestions" th:action="@{/booking/{id}/question/{qid}(id=${booking.bookingID}, qid=${questionid})}" method="post" th:hidden="true">
                    <input hidden type="submit" value="nextQuestions"/>
                </form>
            </th:block>
        </th:block>
    </th:block>
    <script th:inline="javascript" th:if="${timer != null}">
        var x = setInterval( function()
       {
          var timer = $('.js-timeout').html();
          var seconds = timer;
          if(seconds > 0){
            seconds -= 1;
          }

          $('.js-timeout').html(seconds);

          if (seconds <= 0)
          {
            clearInterval(x);
            $.ajax({
                type: "POST",
                url : '/booking/settimeout',
                data: { timer: 1, bookingID:
                        [# th:if="${booking != null }"]
                            /*[[${booking.bookingID}]]*/ 'bookingID'
                        [/]
                        }
            });
          }
      }, 1000);
    </script>

    <div id="questions" th:if= "${questions != null}">
        <p class="timer" th:if="${timer != null}">Time will end in <span class="js-timeout" id="js-timeout" th:text="${timer}"></span></p><br/>
        <span th:text="${questions.description}"></span>
        <table>
            <th:block th:each="multipleChoice : ${multipleChoices}">
                <tr>
                    <td th:text="${multipleChoice.description}"></td>
                </tr>
            </th:block>
        </table>
    </div>
    <th:block th:if="${finished != null}">
        <span>
            Quiz Finished
        </span>
    </th:block>

    <script th:inline="javascript" th:if="${booking != null}">
        var interval;
        function getAttendance() {
            $.ajax({
                type: "POST",
                url : '/booking/getattendance',
                data: { bookingID:
                        [# th:if="${booking != null }"]
                            /*[[${booking.bookingID}]]*/ 'bookingID'
                        [/]
                    },
                success: function (data) {
                    $('#attendance_count').html("Attending: "+data);
                    interval = setTimeout(getAttendance, 1000);
                }
            });
        }
        getAttendance();
    </script>

    <script th:inline="javascript" th:if="${booking != null}">
        var studentAnswerInt;
        function getStudentAnswers() {
            $.ajax({
                type: "POST",
                url : '/booking/getstudentanswers',
                data: { bookingID:
                        [# th:if="${booking != null }"]
                            /*[[${booking.bookingID}]]*/ 'bookingID'
                        [/]
                    },
                success: function (data) {
                    if(data.length != 0){
                        $('#answerCounter').html(data);
                    }
                    studentAnswerInt = setTimeout(getStudentAnswers, 1000);
                }
            });
        }
        getStudentAnswers();
    </script>

    <h4 id="attendance_count"></h4>
<<<<<<< HEAD


    <script th:inline="javascript" th:if="${booking != null}">
            google.charts.load('current', {'packages':['corechart']});
            google.setOnLoadCallback(drawChart);

            function drawChart() {
                //var data = google.visualization.arrayToDataTable();
                // Create our data table out of JSON data loaded from server.
                //var data = new google.visualization.DataTable(/*[[${studentAnswers}]]*/);
                var data = new google.visualization.DataTable();
                data.addColumn('string', 'Quiz Answers');
                data.addColumn('number', 'Amount of Answers');
                data.addRows([
                  ['Attending', 0],
                  ['Answers', 0]
                ]);

                var interval;
                function getAttendance() {
                    $.ajax({
                        type: "POST",
                        url : '/booking/getanswerattendance',
                        data: { bookingID:
                                [# th:if="${booking != null }"]
                                    /*[[${booking.bookingID}]]*/ 'bookingID'
                                [/]
                            },
                        success: function (value) {
                            console.log(value)
                            if(value[0] > 0){
                                data.setValue(0, 1, value[0]);
                                chart.draw(data, options);
                            }
                            interval = setTimeout(getAttendance, 1000);
                        }
                    });
                }
                getAttendance();


                var options = {
                    title: 'Attending vs Answers',
                    is3D: true,
                    sliceVisibilityThreshold: .2,
                    pieSliceText: 'value',
                    backgroundColor: { fill:'transparent' }
                };

                // Instantiate and draw our chart, passing in some options.
                var chart = new google.visualization.PieChart(document.getElementById('chart_div'));
                chart.draw(data, options);
                console.log(data)
            }
    </script>

    <div id="chart_div" style="width: 900px; height: 500px;"></div>

    <div id="answerCounter" th:fragment="studentAnswer">

=======
    <div id="answerCounter" th:fragment="studentAnswer">
>>>>>>> parent of 545255a... add colour to table in css file
        <table>
            <th:block >
                <tr th:each="studentAnswer : ${studentAnswers}">
                    <th th:text="${studentAnswer.value}"></th>
                    <td th:text="${studentAnswer.key}"></td>
                </tr>
            </th:block>
        </table>
    </div>
    <input type="button"  onclick="location.href='/booking/'" value="Back" >
</body>
</html>

